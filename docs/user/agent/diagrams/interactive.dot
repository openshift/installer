digraph agent_installer_services_interactive {
    rankdir=BT;
    node [shape=box, style="rounded,filled", fillcolor="#ADD8E6", fontname="Arial", fontsize=10, penwidth=1];
    edge [color="#333333"];

    // Bottom row - foundation services
    {
        node [fillcolor="#ADD8E6"];
        agent_extract_tui [label="agent-extract-tui"];
        selinux [label="selinux"];
        pre_network_manager_config [label="pre-network-manager-config"];
        set_hostname [label="set-hostname"];
        iscsistart [label="iscsistart", penwidth=0.5];
        iscsiadm [label="iscsiadm", penwidth=0.5];
    }

    // Files (document style)
    node [shape=note, fillcolor="#FFFACD"];
    node0_file [label="/etc/assisted/node0"];

    // Middle services
    node [shape=box, style="rounded,filled", fillcolor="#ADD8E6", penwidth=1];
    agent_interactive_console [label="agent-interactive-console", fillcolor="#6495ED", penwidth=2];
    agent [label="agent"];
    node_zero [label="node-zero"];

    // Assisted service pod (subgraph cluster) - includes agent-start-ui
    subgraph cluster_pod {
        label="";
        style=dashed;
        color="#666666";
        fillcolor="#FFFFFF";

        assisted_service_pod [label="assisted-service-pod", fillcolor="#ADD8E6"];
        assisted_service [label="assisted-service", fillcolor="#ADD8E6"];
        assisted_service_db [label="assisted-service-db", fillcolor="#ADD8E6"];
        install_status [label="install-status", fillcolor="#ADD8E6"];
        agent_start_ui [label="agent-start-ui", fillcolor="#ADD8E6"];

        assisted_service_pod -> assisted_service [style=invis];
        assisted_service_pod -> assisted_service_db [style=invis];
        assisted_service -> agent_start_ui [style=invis];
    }

    // Dependencies (bottom to top flow)

    // Interactive console branches
    agent_extract_tui -> agent_interactive_console;
    selinux -> agent_interactive_console;
    pre_network_manager_config -> agent_interactive_console;
    set_hostname -> agent_interactive_console;
    agent_interactive_console -> agent;
    agent_interactive_console -> node_zero;

    // Node zero creates file and starts pod
    node_zero -> node0_file [style=dotted];
    node_zero -> assisted_service_pod;

    // Pod relationships
    assisted_service_pod -> install_status;
    assisted_service_pod -> assisted_service [constraint=false];
    assisted_service_pod -> assisted_service_db [constraint=false];

    // UI service
    assisted_service -> agent_start_ui;

    // Rank constraints for better layout
    {rank=same; agent_extract_tui; selinux; pre_network_manager_config; set_hostname; iscsistart; iscsiadm;}
    {rank=same; agent_interactive_console;}
    {rank=same; agent; node_zero;}
}
